var auth_token=$("#ApiToken").val();function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var checkFormValidity=function(){var e=[];$("#clientEditForm :input").each(function(){this.checkValidity()||e.push(this)}),e.length?($("#saveEditClient").addClass("disabled"),$("#saveEditClient").prop("disabled",1)):($("#saveEditClient").removeClass("disabled"),$("#saveEditClient").prop("disabled",0))};function viewPassword(){var e=$("#PasswordInput"),a=$("i","#ViewPassword");"password"==e.attr("type")?(e.attr({type:"text"}),a.removeClass(),a.addClass("fas fa-eye-slash")):(e.attr({type:"password"}),a.removeClass(),a.addClass("fas fa-eye"))}function generatePassword(){const e=new XMLHttpRequest;e.overrideMimeType("application/json"),e.open("GET","/api/meetpat-admin/generate-password",!0),e.send(),e.onload=function(){var a=JSON.parse(e.responseText);$("#PasswordInput").val(a.password),$("#PasswordInput").removeClass("is-invalid"),$("#PasswordInput").removeClass("is-valid"),$("#PasswordInput").addClass("is-valid"),document.getElementById("PasswordInput").setCustomValidity(""),checkFormValidity()}}var set_status=function(e){var a=e.getAttribute("data-user-id");$(".spinner-border",e).removeClass("d-none"),$.ajax({url:"/api/meetpat-admin/users/active-status-change",data:{user_id:a,api_token:auth_token},method:"POST",success:function(a){$(".spinner-border",e).addClass("d-none"),a.user_was_active?($(e).removeClass("fa-toggle-on"),$(e).addClass("fa-toggle-off")):($(e).removeClass("fa-toggle-off"),$(e).addClass("fa-toggle-on"))},error:function(a){$("#mainAlertSection").html('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error</strong> - An error has occured while attempting to update the current users status. Please contact support if the problem persists.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$(".spinner-border",e).addClass("d-none"),$("i",e).show()}})},open_edit=function(e){var a=e.getAttribute("data-user-id");$("#modalsContainer").html('<div class="modal" data-backdrop="static" data-keyboard="false" tabindex="-1" id="editModal" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Edit Client Details</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" id="modalBody"><div class="d-flex justify-content-center"><div class="spinner-border" role="status"><span class="sr-only">&nbsp;Loading...</span></div></div></div><div class="modal-footer"><button id="saveEditClient" type="button" class="btn btn-primary disabled"><strong>Save Changes</strong></button><button type="button" class="btn btn-secondary" data-dismiss="modal"><strong>Close</strong></button></div></div></div></div>'),$("#saveEditClient").prop("disabled",1),$("#editModal").modal("show");var s=$.ajax({url:"/api/meetpat-admin/client/get",data:{api_token:auth_token,user_id:a},method:"GET",success:function(e){$("#modalBody").html(`<form id="clientEditForm" autocomplete="off" onsubmit="return false;" novalidate=""><div class="row"><div class="col-12"><div class="alert alert-warning" role="alert"><strong>Warning</strong> — These actions can not be undone.</div></div><div class="col-12" id="alertSectionDetails"></div></div><div class="row"><div class="col-12"><div class="form-group"><label class="form-label" for="clientName">User Name</label><input id="clientName" name="clientName" class="form-control is-valid" type="text" value="${e.client.name}" autofocus/></div><div class="form-group"><label class="form-label" for="clientEmail">Email Address</label><input id="clientEmail" autocomplete="email" name="clientEmail" class="form-control is-valid" type="email" value="${e.client.email}" /></div><div class="form-group d-flex justify-content-end"><button class="btn ChangePasswordBtn PasswordInput collapsed btn-warning" type="button" id="ChangePasswordBtn" data-toggle="collapse" data-target=".collapsePasswordChange" aria-expanded="false" aria-controls="collapseExample" value="">Change Password</button></div><div id="collapsePasswordChange" class="collapsePasswordChange collapse" style=""><div class="card card-body"><div class="form-group"><label for="new-password">New Password</label><div class="input-group"><input type="password" autocomplete="new-password" id="PasswordInput" data-user="1" name="new_password" class="form-control PasswordInput"><div class="input-group-append"><button id="GeneratePassword" onclick="generatePassword(this)" class="btn btn-outline-secondary view-password generate-password GeneratePassword" data-user="1" onclick="generatePassword(this)" type="button" data-toggle="tooltip" data-placement="top" title="" data-original-title="generate password"><i class="fas fa-random"></i></button></div><div class="input-group-append"><button id="ViewPassword" onclick="viewPassword(this)" class="btn btn-outline-secondary view-password ViewPassword" onclick="viewPassword(this);" data-user="1" type="button" data-toggle="tooltip" data-placement="top" title="" data-original-title="view password"><i class="fas fa-eye"></i></button></div><div class="invalid-feedback">This field is required.</div></div><small id="passwordHelpBlock" class="form-text text-muted">Your password must be 8-20 characters long, contain letters, at least one number and symbol.</small></div><div class="form-group mt-3"><label class="container-label">Send password to user email address<input id="sendMail" type="checkbox" name="send_mail"><span class="checkmark"></span></label></div></div></div></div></div></form>`),$("#clientName").on("keyup change",function(){$(this).val().length<2||!$(this).val().match(/^[a-zA-Z0-9]([_a-zA-Z0-9-& ])*[a-zA-Z0-9]$/g)?($(this).removeClass("is-valid"),$(this).addClass("is-invalid"),this.setCustomValidity("invalid")):($(this).removeClass("is-invalid"),$(this).addClass("is-valid"),this.setCustomValidity("")),checkFormValidity()}),$("#clientEmail").on("keyup change",function(){$(this).val().length<2||!$(this).val().match(/^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,})$/g)?($(this).removeClass("is-valid"),$(this).addClass("is-invalid"),this.setCustomValidity("invalid")):($(this).removeClass("is-invalid"),$(this).addClass("is-valid"),this.setCustomValidity("")),checkFormValidity()}),$("#collapsePasswordChange").on("hidden.bs.collapse",function(){$("#ChangePasswordBtn").html("Change Password"),$("#ChangePasswordBtn").removeClass("btn-danger"),$("#ChangePasswordBtn").addClass("btn-warning"),$("#PasswordInput").removeClass("is-valid"),$("#PasswordInput").removeClass("is-invalid"),$("#PasswordInput").val(""),document.getElementById("PasswordInput").setCustomValidity(""),$("#sendMail").prop("checked",0),checkFormValidity()}),$("#collapsePasswordChange").on("show.bs.collapse",function(){$("#ChangePasswordBtn").html("Cancel"),$("#ChangePasswordBtn").removeClass("btn-warning"),$("#ChangePasswordBtn").addClass("btn-danger"),document.getElementById("PasswordInput").setCustomValidity("invalid"),checkFormValidity(),$("#PasswordInput").on("keyup change",function(){$(this).val().match(/^(?=.*[A-Za-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/)?($(this).removeClass("is-invalid"),$(this).addClass("is-valid"),this.setCustomValidity("")):($(this).removeClass("is-valid"),$(this).addClass("is-invalid"),this.setCustomValidity("invalid")),checkFormValidity()})}),checkFormValidity(),$("#saveEditClient").removeClass("disabled"),$("#saveEditClient").prop("disabled",0)},error:function(e){$("#modalBody").html('<div class="alert alert-danger" role="alert"><strong>Error</strong> - An error occured getting user data. Reload the current page or contact support for assistance.</div>')}});$("#saveEditClient").click(function(){$(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><strong>&nbsp;Saving...</strong>'),$(this).prop("disabled",1);var e=$("input[name='clientName']").val(),s=$("input[name='clientEmail']").val(),t=$("input[name='new_password']").val(),n=$("input[name='send_mail']").is(":checked"),i=$.ajax({url:"/api/meetpat-admin/users/edit",method:"POST",data:{user_id:a,user_name:e,user_email:s,new_password:t,send_mail:n},success:function(e){"true"==e.sent_mail?$("#alertSectionDetails").html(`<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Success</strong> - The current users details have been updated. An email with the new password has been sent to <strong>${s}</strong>.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`):$("#alertSectionDetails").html('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Success</strong> - The current users details have been updated.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#saveEditClient").html("<strong>Save Changes</strong>"),$("#saveEditClient").prop("disabled",0)},error:function(e){$("#alertSectionDetails").html('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error</strong> - An error has occured while trying to update the current users details. Please contact support if the problem persists.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#saveEditClient").html("<strong>Save Changes</strong>"),$("#saveEditClient").prop("disabled",0)}});$("#editModal").on("hidden.bs.modal",function(){i.abort(),$("#modalsContainer").empty()})}),$("#editModal").on("hidden.bs.modal",function(){s.abort(),$("#modalsContainer").empty()})},open_settings=function(e){var a=e.getAttribute("data-user-id");$("#modalsContainer").html('<div class="modal" data-backdrop="static" data-keyboard="false" tabindex="-1" id="settingsModal" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Change Client Settings</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" id="modalBody"><div class="d-flex justify-content-center"><div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal"><strong>Close</strong></button></div></div></div></div>'),$("#saveSettingsClient").prop("disabled",1),$("#settingsModal").modal("show");var s=$.ajax({url:"/api/meetpat-admin/client/get",data:{api_token:auth_token,user_id:a},method:"GET",success:function(e){$("#modalBody").html('<form id="clientSettingsForm" onsubmit="return false;" novalidate=""><div class="row"><div class="col-12"><div class="alert alert-warning" role="alert"><strong>Warning</strong> — These actions can not be undone.</div></div><div class="col-12" id="alertSectionSettings"></div></div><div class="row"><div class="col-12"><div class="form-group"><label class="form-label" for="clientUploadLimit">Upload Limit</label><div class="progress"><div class="progress-bar" id="userUploadsPercentage" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0/0</div></div></div></div></div><div class="row"><div class="col-6 col-md-8 col-sm-6 col-xs-6"><input id="newUploadLimit" type="number" min="0" max="10000000" class="form-control" name="new_upload_limit" value="0"><div class="invalid-feedback">A new limit cant be less than the current users uploads.</div></div><div class="col-6 col-md-4 col-sm-6 col-xs-6"><button id="saveNewUploadLimit" class="btn btn-primary btn-block float-right"><strong>Save</strong></button></div></div></form><div class="row mt-3"><div class="col-12"><button id="resetUploads" class="btn btn-warning btn-block"><strong>Reset Uploads</strong></button></div></div>'),$("#userUploadsPercentage").width(e.client.client_uploads.uploads/e.client.client_uploads.upload_limit*100+"%"),$("#userUploadsPercentage").html(e.client.client_uploads.uploads+"/"+e.client.client_uploads.upload_limit),$("#newUploadLimit").val(e.client.client_uploads.upload_limit),$("#newUploadLimit").attr({min:e.client.client_uploads.uploads}),$("#newUploadLimit").on("change keyup",function(){$(this).val()<e.client.client_uploads.uploads?($(this).removeClass("is-valid"),$(this).addClass("is-invalid"),$("#saveNewUploadLimit").prop("disabled",1)):($(this).addClass("is-valid"),$(this).removeClass("is-invalid"),$("#saveNewUploadLimit").prop("disabled",0))}),$("#saveNewUploadLimit").click(function(){if(1==confirm("Are you sure that you want to change this users upload limit to "+numberWithCommas($("#newUploadLimit").val())+"?")){$(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><strong>&nbsp;Saving...</strong>'),$(this).prop("disabled",1),$("#resetUploads").prop("disabled",1);var e=$.ajax({url:"/api/meetpat-admin/settings/updated-upload-limit",method:"POST",data:{api_token:auth_token,user_id:a,new_upload_limit:$("#newUploadLimit").val()},success:function(e){$("#userUploadsPercentage").width(e.client_uploads.uploads/$("#newUploadLimit").val()*100+"%"),$("#userUploadsPercentage").html(e.client_uploads.uploads+"/"+$("#newUploadLimit").val()),$("#saveNewUploadLimit").html("<strong>Save</strong>"),$("#saveNewUploadLimit").prop("disabled",0),$("#resetUploads").prop("disabled",0),$("#newUploadLimit").attr({min:e.client_uploads.uploads}),$("#newUploadLimit").on("change keyup",function(){$(this).val()<e.client_uploads.uploads?($(this).removeClass("is-valid"),$(this).addClass("is-invalid"),$("#saveNewUploadLimit").prop("disabled",1)):($(this).addClass("is-valid"),$(this).removeClass("is-invalid"),$("#saveNewUploadLimit").prop("disabled",0))})},error:function(e){$("#alertSectionSettings").html('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error</strong> - An error has occured while trying to update the current users limits. Please contact support if the problem persists.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#saveNewUploadLimit").prop("disabled",0),$("#resetUploads").prop("disabled",0)}});$("#settingsModal").on("hidden.bs.modal",function(){e.abort(),$("#modalsContainer").empty()})}}),$("#resetUploads").click(function(){if(1==confirm("Are you sure that you want to set this users uploads back to 0?")){$("#saveNewUploadLimit").prop("disabled",1),$(this).prop("disabled",1),$(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><strong>&nbsp;Resetting Uploads...</strong>');var e=$.ajax({url:"/api/meetpat-admin/settings/clear-uploads",method:"POST",data:{api_token:auth_token,user_id:a},success:function(e){$("#alertSectionSettings").html('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Success</strong> - User limits have been updated.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#userUploadsPercentage").width("0%"),$("#userUploadsPercentage").html("0/"+$("#newUploadLimit").val()),$("#saveNewUploadLimit").prop("disabled",0),$("#resetUploads").prop("disabled",0),$("#resetUploads").html("<strong>Reset Uploads</strong>")},error:function(e){$("#alertSectionSettings").html('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error</strong> - An error has occured while trying to update the current users limits. Please contact support if the problem persists.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),$("#saveNewUploadLimit").prop("disabled",1),$("#saveNewUploadLimit").prop("disabled",1),$("#saveNewUploadLimit").html("Reset Uploads")}});$("#settingsModal").on("hidden.bs.modal",function(){e.abort(),$("#modalsContainer").empty()})}})},error:function(e){$("#modalBody").html('<div class="alert alert-danger" role="alert"><strong>Error</strong> - An error occured getting user data. Reload the current page or contact support for assistance.</div>')}});$("#settingsModal").on("hidden.bs.modal",function(){s.abort(),$("#modalsContainer").empty()})},delete_user=function(e){var a=e.getAttribute("data-user-id"),s=e.getAttribute("data-user-name");$("#modalsContainer").html(`<form id="clientSettingsForm" onsubmit="return false;" novalidate=""><div class="modal fade" id="deleteClientModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="deleteClientModalLabel" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="deleteClientModalLabel">Delete Client (${s})</h5><button type="button" id="closeModal" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" id="modalBody"><label>Confirm client name to delete</label><input name="user_name" class="form-control" id="deleteClient-${a}" placeholder="Enter Client Name" /></div><div class="modal-footer"><button type="button" id="closeBtn" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="button" id="deleteClientBtn" class="btn btn-danger">Delete Client</button></div></div></div></div></form>`),$("#deleteClientModal").modal("show"),$("#deleteClientBtn").prop("disabled",1),$("#deleteClientBtn").click(function(){$("#deleteClientBtn").prop("disabled",1),$("#closeBtn").prop("disabled",1),$("#closeModal").prop("disabled",1),$("#deleteClientBtn").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><strong>&nbsp;Requesting...</strong>');var e=$.ajax({url:"/api/meetpat-admin/users/delete",method:"POST",data:{user_id:a,user_name:s},success:function(e){"success"==e.status?($("#deleteClientBtn").html("Done"),$("#deleteClientBtn").removeClass("btn-danger"),$("#deleteClientBtn").addClass("btn-success"),$("#closeBtn").prop("disabled",0),$("#closeModal").prop("disabled",0),$("#modalBody .alert").remove(),$("#modalBody").prepend('<div class="alert alert-success" role="alert"><strong>Success</strong> - Client queued for removal.</div>'),$("#client-"+a).remove(),$("#client-mobile-heading-"+a).remove(),$("#client-mobile-body-"+a).remove(),$("#refreshBtn").click()):($("#modalBody .alert").remove(),$("#modalBody").prepend('<div class="alert alert-danger" role="alert"><strong>Error</strong> - An error occured getting user data. Reload the current page or contact support for assistance.</div>'),$("#deleteClientBtn").prop("disabled",0),$("#closeBtn").prop("disabled",0),$("#closeModal").prop("disabled",0),$("#deleteClientBtn").html("Delete Client"))},error:function(e){$("#modalBody .alert").remove(),$("#modalBody").prepend('<div class="alert alert-danger" role="alert"><strong>Error</strong> - An error occured getting user data. Reload the current page or contact support for assistance.</div>'),$("#deleteClientBtn").prop("disabled",0),$("#closeBtn").prop("disabled",0),$("#closeModal").prop("disabled",0),$("#deleteClientBtn").html("Delete Client"),console.log(e)}});$("#deleteClientModal").on("hidden.bs.modal",function(){e.abort(),$("#modalsContainer").empty()})}),$("#deleteClient-"+a).on("keyup",function(){$(this).val()==s?($(this).removeClass("is-invalid"),$("#deleteClientBtn").prop("disabled",0),$(this).hasClass("is-valid")||$(this).addClass("is-valid")):0==$(this).val().length?($("#deleteClientBtn").prop("disabled",1),$(this).removeClass("is-invalid")):($(this).removeClass("is-valid"),$("#deleteClientBtn").prop("disabled",1),$(this).hasClass("is-invalid")||$(this).addClass("is-invalid"))})};